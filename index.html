<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>МІЙ НАМІР НА МОВІ ВСЕСВІТУ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #050816 0%, #020617 50%, #020617 100%);
      color: #e5e7eb;
    }
    .wrapper {
      max-width: 980px;
      margin: 0 auto;
      padding: 24px 16px 48px;
    }
    h1 {
      font-size: 2.1rem;
      margin-bottom: 0.3rem;
      text-align: center;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #f9fafb;
    }
    h1 span {
      color: #facc15;
    }
    p {
      margin: 0.2rem 0 0.5rem;
      line-height: 1.5;
    }

    .subtitle {
      text-align: center;
      font-size: 0.95rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #a5b4fc;
    }

    .card {
      position: relative;
      overflow: hidden;
      border-radius: 24px;
      padding: 24px 18px 26px;
      margin-top: 1.6rem;
      background: radial-gradient(circle at top, rgba(15,23,42,0.95) 0%, rgba(15,23,42,0.98) 40%, rgba(15,23,42,1) 100%);
      box-shadow: 0 26px 60px rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.55);
    }
    .mandala-bg {
      position: absolute;
      inset: -40px;
      background-image: url("Mandala_wish_6/mandala_bg.png");
      background-repeat: no-repeat;
      background-position: center 10%;
      background-size: 520px 520px;
      opacity: 0.25;
      filter: blur(0.4px);
      pointer-events: none;
      z-index: 0;
    }
    .card-inner {
      position: relative;
      z-index: 1;
      display: grid;
      grid-template-columns: minmax(0, 1.15fr) minmax(0, 1fr);
      gap: 18px 28px;
    }
    @media (max-width: 860px) {
      .card-inner {
        grid-template-columns: minmax(0, 1fr);
      }
      .mandala-bg {
        background-position: center top;
        background-size: 430px 430px;
      }
    }

    .left-block {
      padding-right: 6px;
    }

    textarea {
      width: 100%;
      min-height: 96px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #4b5563;
      background: rgba(15,23,42,0.9);
      resize: vertical;
      font-size: 1rem;
      color: #e5e7eb;
      box-sizing: border-box;
      outline: none;
    }
    textarea::placeholder {
      color: #6b7280;
    }
    textarea:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px #6366f1;
    }

    .controls {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      font-size: 0.97rem;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #6366f1, #ec4899);
      color: white;
      box-shadow: 0 10px 22px rgba(99, 102, 241, 0.45);
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
    }
    button:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 16px 30px rgba(79, 70, 229, 0.7);
    }
    button:active {
      transform: translateY(0);
      box-shadow: 0 8px 16px rgba(79, 70, 229, 0.5);
    }

    .output-block {
      background: rgba(15,23,42,0.9);
      border-radius: 14px;
      padding: 10px 12px 12px;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      margin-top: 10px;
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.95rem;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .output-title {
      font-weight: 600;
      margin-bottom: 4px;
      color: #e5e7eb;
    }
    .output-value {
      letter-spacing: 0.12em;
    }

    .matrix-wrapper {
      display: flex;
      gap: 24px;
      justify-content: center;
      margin-top: 6px;
      flex-wrap: wrap;
    }
    .matrix-triangle {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    .matrix-label {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 0.8rem;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    .matrix-row {
      display: flex;
      gap: 10px;
    }
    .matrix-digit {
      width: 20px;
      text-align: center;
    }

    .legend-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 6px 12px;
      margin-top: 6px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 0.86rem;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .legend-digit {
      font-weight: 600;
      min-width: 16px;
    }
    .color-chip {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(15,23,42,0.7);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.4);
    }
    .legend-name {
      text-transform: lowercase;
    }

    .footer {
      margin-top: 24px;
      font-size: 0.8rem;
      color: #9ca3af;
      text-align: center;
    }

    .pdf-btn-wrap {
      margin-top: 14px;
      display: flex;
      justify-content: flex-end;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1><span>МІЙ НАМІР</span> НА МОВІ ВСЕСВІТУ</h1>
    <p class="subtitle">числовий код та мандальна матриця наміру</p>

    <div class="card">
      <div class="mandala-bg"></div>

      <div class="card-inner">
        <!-- ЛІВА ЧАСТИНА -->
        <div class="left-block">
          <h2 style="margin-top:0; font-size:1.05rem;">1. Введіть свій намір</h2>
          <p>Пишіть щиро, українською, в стверджувальній формі.</p>

          <textarea id="wishInput" placeholder="Наприклад: Легко, радісно і вільно проявляю свій дар та отримую гідну винагороду."></textarea>

          <div class="controls">
            <button id="generateBtn">Створити числовий код наміру</button>
          </div>

          <div class="output-block" id="initialBlock" style="display:none;">
            <div class="output-title">Початковий числовий ряд (усі цифри наміру):</div>
            <div class="output-value" id="initialRow">—</div>
          </div>

          <div class="output-block" id="row6Block" style="display:none;">
            <div class="output-title">Скорочений код наміру (6 чисел):</div>
            <div class="output-value" id="row6">—</div>
          </div>
        </div>

        <!-- ПРАВА ЧАСТИНА -->
        <div>
          <div class="output-block" id="matrixBlock" style="display:none;">
            <div class="output-title">Трикутна матриця для мандали:</div>
            <div id="matrixWrapper" class="matrix-wrapper">
              <div class="matrix-triangle">
                <div class="matrix-label">Основний код</div>
                <div id="matrixTriangleMain"></div>
              </div>
              <div class="matrix-triangle">
                <div class="matrix-label">Дзеркальний код</div>
                <div id="matrixTriangleMirror"></div>
              </div>
            </div>
          </div>

          <div class="output-block" id="colorBlock" style="display:none;">
            <div class="output-title">Кольоровий код для цього наміру:</div>
            <div id="colorLegend" class="legend-list"></div>
          </div>

          <div class="pdf-btn-wrap" id="pdfBlock" style="display:none;">
            <button id="downloadPdfBtn">Скачати PDF з кодом наміру</button>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      Перенесіть числа та кольори у мандалу — це запис вашого наміру на мові Всесвіту.
    </div>
  </div>

  <!-- jsPDF для завантаження PDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <script>
    // Букви → числа
    function textToNumbers(text) {
      const map = {
        'а':1, 'б':2, 'в':3, 'г':4, 'ґ':5, 'д':6, 'е':7, 'є':8, 'ж':9,
        'з':1, 'и':2, 'і':3, 'ї':4, 'й':5, 'к':6, 'л':7, 'м':8, 'н':9,
        'о':1, 'п':2, 'р':3, 'с':4, 'т':5, 'у':6, 'ф':7, 'х':8, 'ц':9,
        'ч':1, 'ш':2, 'щ':3, 'ь':4, 'ю':5, 'я':6
      };

      return text
        .toLowerCase()
        .split('')
        .map(ch => map[ch])
        .filter(num => num !== undefined);
    }

    // сума пари → одна цифра 1–9 (цифровий корінь)
    function pairSumDigit(a, b) {
      let sum = a + b;
      while (sum >= 10) {
        sum = Math.floor(sum / 10) + (sum % 10);
      }
      if (sum === 0) sum = 1;
      return sum;
    }

    // редукція одного ряду
    function mandalaReduce(arr) {
      const reduced = [];
      for (let i = 0; i < arr.length - 1; i++) {
        reduced.push(pairSumDigit(arr[i], arr[i + 1]));
      }
      return reduced;
    }

    // скорочення до 6 чисел
    function reduceToSix(numbers) {
      let result = [...numbers];
      while (result.length > 6) {
        result = mandalaReduce(result);
      }
      while (result.length < 6 && result.length >= 2) {
        const last  = result[result.length - 1];
        const prev  = result[result.length - 2];
        const next  = pairSumDigit(prev, last);
        result.push(next);
      }
      return result;
    }

    // трикутна матриця: перший (найдовший) ряд зверху, далі все коротше
    function buildTriangleMatrix(firstRow) {
      const matrix = [];
      let current = [...firstRow];
      matrix.push(current);
      while (current.length > 1) {
        current = mandalaReduce(current);
        matrix.push(current);
      }
      return matrix; // [6,5,4,3,2,1]
    }

    // кольори
    const colorCycle = [
      'червоний',
      'синій',
      'зелений',
      'жовтий',
      'блакитний',
      'бірюзовий',
      'рожевий',
      'помаранчевий',
      'фіолетовий'
    ];
    const color0 = 'золотий';

    const colorNameToCss = {
      'червоний': '#ef4444',
      'синій': '#3b82f6',
      'зелений': '#22c55e',
      'жовтий': '#eab308',
      'блакитний': '#38bdf8',
      'бірюзовий': '#14b8a6',
      'рожевий': '#ec4899',
      'помаранчевий': '#f97316',
      'фіолетовий': '#a855f7',
      'золотий': '#facc15'
    };

    function getColorForDigit(digit, firstDigit) {
      if (digit === 0) return color0;
      const shift = (firstDigit - 1) % 9;
      const idx = (digit - 1 + shift) % 9;
      return colorCycle[idx];
    }

    function buildColorLegend(firstDigit) {
      const legend = [];
      for (let d = 1; d <= 9; d++) {
        legend.push({ digit: d, color: getColorForDigit(d, firstDigit) });
      }
      legend.push({ digit: 0, color: color0 });
      return legend;
    }

    // DOM
    const wishInput      = document.getElementById('wishInput');
    const initialRowEl   = document.getElementById('initialRow');
    const row6El         = document.getElementById('row6');
    const matrixTriangleMain   = document.getElementById('matrixTriangleMain');
    const matrixTriangleMirror = document.getElementById('matrixTriangleMirror');
    const colorLegendEl  = document.getElementById('colorLegend');

    const initialBlock = document.getElementById('initialBlock');
    const row6Block    = document.getElementById('row6Block');
    const matrixBlock  = document.getElementById('matrixBlock');
    const colorBlock   = document.getElementById('colorBlock');
    const pdfBlock     = document.getElementById('pdfBlock');
    const generateBtn  = document.getElementById('generateBtn');
    const downloadPdfBtn = document.getElementById('downloadPdfBtn');

    let lastData = null; // для PDF

    // малюємо трикутник вершиною вниз (довгий ряд зверху)
    function renderTriangle(container, matrix) {
      container.innerHTML = '';
      matrix.forEach(function(row) {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'matrix-row';
        row.forEach(function(d) {
          const span = document.createElement('span');
          span.className = 'matrix-digit';
          span.textContent = d;
          rowDiv.appendChild(span);
        });
        container.appendChild(rowDiv);
      });
    }

    generateBtn.addEventListener('click', function () {
      const text = wishInput.value.trim();

      if (!text) {
        alert('Будь ласка, впишіть свій намір.');
        return;
      }

      const baseNumbers = textToNumbers(text);

      if (baseNumbers.length < 2) {
        alert('Замало символів для побудови ряду. Напишіть трохи довший намір.');
        return;
      }

      const row6   = reduceToSix(baseNumbers);
      const matrixMain   = buildTriangleMatrix(row6);
      const row6Reversed = row6.slice().reverse();
      const matrixMirror = buildTriangleMatrix(row6Reversed);

      initialRowEl.textContent = baseNumbers.join(' ');
      row6El.textContent       = row6.join(' ');

      renderTriangle(matrixTriangleMain, matrixMain);
      renderTriangle(matrixTriangleMirror, matrixMirror);

      const firstDigit = baseNumbers[0];
      const legend = buildColorLegend(firstDigit);
      colorLegendEl.innerHTML = '';
      legend.forEach(function (item) {
        const div = document.createElement('div');
        div.className = 'legend-item';

        const digitSpan = document.createElement('span');
        digitSpan.className = 'legend-digit';
        digitSpan.textContent = item.digit + ' –';

        const chip = document.createElement('span');
        chip.className = 'color-chip';
        chip.style.backgroundColor = colorNameToCss[item.color] || '#e5e7eb';

        const nameSpan = document.createElement('span');
        nameSpan.className = 'legend-name';
        nameSpan.textContent = item.color;

        div.appendChild(digitSpan);
        div.appendChild(chip);
        div.appendChild(nameSpan);
        colorLegendEl.appendChild(div);
      });

      initialBlock.style.display = 'block';
      row6Block.style.display    = 'block';
      matrixBlock.style.display  = 'block';
      colorBlock.style.display   = 'block';
      pdfBlock.style.display     = 'flex';

      lastData = {
        text: text,
        baseNumbers: baseNumbers,
        row6: row6,
        matrixMain: matrixMain,
        matrixMirror: matrixMirror,
        legend: legend
      };
    });

    downloadPdfBtn.addEventListener('click', function () {
      if (!lastData) return;
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      let y = 10;
      doc.setFontSize(14);
      doc.text('MIY NAMIR NA MOVI VSESVITU', 10, y);
      y += 8;

      doc.setFontSize(11);
      doc.text('Namir (UA):', 10, y);
      y += 6;
      doc.text(doc.splitTextToSize(lastData.text, 180), 10, y);
      y += 10;

      doc.text('Pochatkovyi chyslovyi riad:', 10, y);
      y += 6;
      doc.text(lastData.baseNumbers.join(' '), 10, y);
      y += 8;

      doc.text('Skorochene koduvannia (6 chysel):', 10, y);
      y += 6;
      doc.text(lastData.row6.join(' '), 10, y);
      y += 10;

      doc.text('Trykutna matrytsia (osnovnyi kod):', 10, y);
      y += 6;
      lastData.matrixMain.forEach(function (row) {
        doc.text(row.join(' '), 10, y);
        y += 6;
      });
      y += 6;

      doc.text('Trykutna matrytsia (dzerkalnyi kod):', 10, y);
      y += 6;
      lastData.matrixMirror.forEach(function (row) {
        doc.text(row.join(' '), 10, y);
        y += 6;
      });
      y += 8;

      doc.text('Kolorovyi kod (tsyfra – kolir):', 10, y);
      y += 6;
      lastData.legend.forEach(function (item) {
        doc.text(item.digit + ' – ' + item.color, 10, y);
        y += 6;
      });

      doc.save('kod_namiru.pdf');
    });
  </script>
</body>
</html>
