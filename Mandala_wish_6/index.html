<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Генератор мандального коду (6 чисел + кольори)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #fdf7ff 0%, #f1f5fb 40%, #e5ecff 100%);
      color: #111827;
    }
    .wrapper {
      max-width: 860px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }
    h1 {
      font-size: 1.9rem;
      margin-bottom: 0.3rem;
      text-align: center;
    }
    h2 {
      font-size: 1.2rem;
      margin-top: 1.2rem;
      margin-bottom: 0.2rem;
    }
    p {
      margin: 0.2rem 0 0.5rem;
      line-height: 1.5;
    }
    .card {
      background: #ffffffcc;
      backdrop-filter: blur(8px);
      border-radius: 18px;
      padding: 18px 16px 20px;
      box-shadow: 0 18px 35px rgba(15, 23, 42, 0.12);
      margin-top: 1.2rem;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }
    textarea {
      width: 100%;
      min-height: 90px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #cbd5f5;
      resize: vertical;
      font-size: 1rem;
      box-sizing: border-box;
      outline: none;
    }
    textarea:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px #6366f1;
    }
    .controls {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      font-size: 0.97rem;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #6366f1, #ec4899);
      color: white;
      box-shadow: 0 10px 22px rgba(99, 102, 241, 0.35);
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
    }
    button:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 14px 26px rgba(79, 70, 229, 0.45);
    }
    button:active {
      transform: translateY(0);
      box-shadow: 0 8px 16px rgba(79, 70, 229, 0.35);
    }
    .hint {
      font-size: 0.87rem;
      color: #4b5563;
    }
    .output-block {
      background: #f9fafb;
      border-radius: 14px;
      padding: 10px 12px 12px;
      border: 1px dashed #cbd5e1;
      margin-top: 10px;
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.95rem;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .output-title {
      font-weight: 600;
      margin-bottom: 4px;
      color: #111827;
    }
    .output-value {
      letter-spacing: 0.12em;
    }
    .matrix-row {
      margin: 2px 0;
    }
    .small-note {
      font-size: 0.8rem;
      color: #6b7280;
      margin-top: 4px;
    }
    .footer {
      margin-top: 24px;
      font-size: 0.8rem;
      color: #6b7280;
      text-align: center;
    }

    /* кольорові елементи */
    .legend-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 6px 12px;
      margin-top: 6px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 0.86rem;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .legend-digit {
      font-weight: 600;
      min-width: 16px;
    }
    .color-chip {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(15,23,42,0.25);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.4);
    }
    .legend-name {
      text-transform: lowercase;
    }
    .row6-colors {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }
    .row6-chip {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 30px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(15,23,42,0.25);
      font-size: 0.8rem;
      color: #111827;
      background: #e5e7eb;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>Числовий код наміру — 6 чисел, матриця і кольори</h1>
    <p style="text-align:center;">
      Введіть намір — генератор створить скорочений ряд із 6 чисел,<br>
      трикутну матрицю та повний кольоровий код для цього наміру.
    </p>

    <div class="card">
      <h2>1. Ваш намір</h2>
      <p>Використовується український алфавіт за вашою мандальною таблицею.</p>

      <textarea id="wishInput" placeholder="Наприклад: Легко й радісно реалізовую свій дар."></textarea>

      <div class="controls">
        <button id="generateBtn">Створити матрицю</button>
        <span class="hint">Букви → числа → скорочення Фібоначчі до 6 членів → трикутник + кольори.</span>
      </div>

      <div class="output-block" id="initialBlock" style="display:none;">
        <div class="output-title">Початковий числовий ряд (усі цифри):</div>
        <div class="output-value" id="initialRow">—</div>
      </div>

      <div class="output-block" id="row6Block" style="display:none;">
        <div class="output-title">Скорочений ряд (6 чисел):</div>
        <div class="output-value" id="row6">—</div>
      </div>

      <div class="output-block" id="matrixBlock" style="display:none;">
        <div class="output-title">Трикутна матриця для мандали:</div>
        <div id="matrixRows"></div>
      </div>

      <div class="output-block" id="colorBlock" style="display:none;">
        <div class="output-title">Кольоровий код для цього наміру:</div>
        <div id="colorLegend" class="legend-list"></div>
        <div class="small-note" id="colorNote"></div>

        <div style="margin-top:8px; font-weight:600;">Кольори для 6-членного ряду:</div>
        <div id="row6Colors" class="row6-colors"></div>
      </div>
    </div>

    <div class="footer">
      Матрицю та кольори можна одразу переносити в мандалу (перший ряд — край сектора, далі — до центру).
    </div>
  </div>

  <script>
    // 1. Букви → числа (твоя таблиця)
    function textToNumbers(text) {
      const map = {
        'а':1, 'б':2, 'в':3, 'г':4, 'ґ':5, 'д':6, 'е':7, 'є':8, 'ж':9,
        'з':1, 'и':2, 'і':3, 'ї':4, 'й':5, 'к':6, 'л':7, 'м':8, 'н':9,
        'о':1, 'п':2, 'р':3, 'с':4, 'т':5, 'у':6, 'ф':7, 'х':8, 'ц':9,
        'ч':1, 'ш':2, 'щ':3, 'ь':4, 'ю':5, 'я':6
      };

      return text
        .toLowerCase()
        .split('')
        .map(ch => map[ch])
        .filter(num => num !== undefined);
    }

    // 2. Редукція Фібоначчі (сума сусідніх mod 10)
    function fibonacciReduce(arr) {
      const reduced = [];
      for (let i = 0; i < arr.length - 1; i++) {
        reduced.push((arr[i] + arr[i + 1]) % 10);
      }
      return reduced;
    }

    // 3. Скорочення до 6 чисел
    function reduceToSix(numbers) {
      let result = [...numbers];
      while (result.length > 6) {
        result = fibonacciReduce(result);
      }
      while (result.length < 6 && result.length >= 2) {
        const next = (result[result.length - 1] + result[result.length - 2]) % 10;
        result.push(next);
      }
      return result;
    }

    // 4. Трикутна матриця
    function buildTriangleMatrix(firstRow) {
      const matrix = [];
      let current = [...firstRow];
      matrix.push(current);
      while (current.length > 1) {
        current = fibonacciReduce(current);
        matrix.push(current);
      }
      return matrix;
    }

    // 5. Кольори
    // цикл 1–9; 0 = золотий (поза циклом)
    const colorCycle = [
      'червоний',     // позиція 0
      'синій',        // 1
      'зелений',      // 2
      'жовтий',       // 3
      'блакитний',    // 4
      'бірюзовий',    // 5
      'рожевий',      // 6
      'помаранчевий', // 7
      'фіолетовий'    // 8
    ];
    const color0 = 'золотий';

    // для відображення реальних кольорів
    const colorNameToCss = {
      'червоний': '#ef4444',
      'синій': '#3b82f6',
      'зелений': '#22c55e',
      'жовтий': '#eab308',
      'блакитний': '#38bdf8',
      'бірюзовий': '#14b8a6',
      'рожевий': '#ec4899',
      'помаранчевий': '#f97316',
      'фіолетовий': '#a855f7',
      'золотий': '#facc15'
    };

    // колір для однієї цифри при заданій першій цифрі наміру
    function getColorForDigit(digit, firstDigit) {
      if (digit === 0) return color0;
      // firstDigit 1 → зсув 0; 2 → 1; ...; 9 → 8
      const shift = (firstDigit - 1) % 9;
      const idx = (digit - 1 + shift) % 9;
      return colorCycle[idx];
    }

    // будуємо повну легенду 0–9 для даного наміру
    function buildColorLegend(firstDigit) {
      const legend = [];
      for (let d = 1; d <= 9; d++) {
        legend.push({ digit: d, color: getColorForDigit(d, firstDigit) });
      }
      legend.push({ digit: 0, color: color0 });
      return legend;
    }

    // 6. DOM-елементи
    const wishInput     = document.getElementById('wishInput');
    const initialRowEl  = document.getElementById('initialRow');
    const row6El        = document.getElementById('row6');
    const matrixRowsEl  = document.getElementById('matrixRows');
    const colorLegendEl = document.getElementById('colorLegend');
    const colorNoteEl   = document.getElementById('colorNote');
    const row6ColorsEl  = document.getElementById('row6Colors');

    const initialBlock = document.getElementById('initialBlock');
    const row6Block    = document.getElementById('row6Block');
    const matrixBlock  = document.getElementById('matrixBlock');
    const colorBlock   = document.getElementById('colorBlock');

    // 7. Обробка кнопки
    document.getElementById('generateBtn').addEventListener('click', () => {
      const text = wishInput.value.trim();

      if (!text) {
        alert('Будь ласка, впишіть свій намір.');
        return;
      }

      const baseNumbers = textToNumbers(text);

      if (baseNumbers.length < 2) {
        alert('Замало символів для побудови ряду. Напишіть трохи довший намір.');
        return;
      }

      const row6   = reduceToSix(baseNumbers);
      const matrix = buildTriangleMatrix(row6);

      // відображення чисел
      initialRowEl.textContent = baseNumbers.join(' ');
      row6El.textContent       = row6.join(' ');

      // трикутна матриця
      matrixRowsEl.innerHTML = '';
      matrix.forEach((row, idx) => {
        const div = document.createElement('div');
        div.className = 'matrix-row';
        const spaces = '&nbsp;'.repeat((matrix.length - idx - 1) * 2);
        div.innerHTML = spaces + row.join(' ');
        matrixRowsEl.appendChild(div);
      });

      // кольори
      const firstDigit = baseNumbers[0]; // перша цифра наміру
      const legend = buildColorLegend(firstDigit);

      // легенда 0–9
      colorLegendEl.innerHTML = '';
      legend.forEach(item => {
        const div = document.createElement('div');
        div.className = 'legend-item';

        const digitSpan = document.createElement('span');
        digitSpan.className = 'legend-digit';
        digitSpan.textContent = item.digit + ' –';

        const chip = document.createElement('span');
        chip.className = 'color-chip';
        chip.style.backgroundColor = colorNameToCss[item.color] || '#e5e7eb';

        const nameSpan = document.createElement('span');
        nameSpan.className = 'legend-name';
        nameSpan.textContent = item.color;

        div.appendChild(digitSpan);
        div.appendChild(chip);
        div.appendChild(nameSpan);
        colorLegendEl.appendChild(div);
      });

      colorNoteEl.textContent =
        'Кольори зсуваються за першою цифрою наміру. Для цього наміру перша цифра: ' +
        firstDigit + '.';

      // кольори для 6-членного ряду
      row6ColorsEl.innerHTML = '';
      row6.forEach(d => {
        const colorName = getColorForDigit(d, firstDigit);
        const chip = document.createElement('span');
        chip.className = 'row6-chip';
        chip.style.backgroundColor = colorNameToCss[colorName] || '#e5e7eb';
        chip.textContent = d + ' ' + colorName;
        row6ColorsEl.appendChild(chip);
      });

      // показати блоки
      initialBlock.style.display = 'block';
      row6Block.style.display    = 'block';
      matrixBlock.style.display  = 'block';
      colorBlock.style.display   = 'block';
    });
  </script>
</body>
</html>
